<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gryffindor Typing Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', 'Times New Roman', serif;
            background: linear-gradient(135deg, #2c0a0a 0%, #1a0505 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
        }

        .sparkle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #ffd700;
            border-radius: 50%;
            opacity: 0.6;
            animation: twinkle 2s infinite ease-in-out;
            box-shadow: 0 0 10px #ffd700;
        }

        @keyframes twinkle {

            0%,
            100% {
                opacity: 0.3;
                transform: scale(1);
            }

            50% {
                opacity: 0.8;
                transform: scale(1.3);
            }
        }

        .container {
            background: rgba(116, 0, 1, 0.15);
            border: 3px solid #740001;
            border-radius: 12px;
            padding: 20px;
            /* Reduced padding for mobile */
            max-width: 900px;
            width: 90vw;
            /* Responsive width */
            box-shadow: 0 10px 40px rgba(116, 0, 1, 0.5);
            position: relative;
            overflow: hidden;
            /* Prevent spillover */
        }

        .container::before {
            content: '';
            position: absolute;
            top: -3px;
            left: -3px;
            right: -3px;
            bottom: -3px;
            background: linear-gradient(45deg, #d3a625, #740001, #d3a625);
            border-radius: 12px;
            z-index: -1;
        }

        h1 {
            color: #ff6b6b;
            text-align: center;
            margin-bottom: 10px;
            font-size: 32px;
            /* Slightly smaller for mobile safety */
            font-weight: bold;
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.5);
            font-family: 'Georgia', serif;
            letter-spacing: 2px;
            word-wrap: break-word;
            /* Wrap long titles */
        }

        .subtitle {
            color: #d4a574;
            text-align: center;
            margin-bottom: 30px;
            font-size: 18px;
            font-style: italic;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-bottom: 30px;
            gap: 20px;
            flex-wrap: wrap;
            /* Allow wrapping on small screens */
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            flex: 1;
            min-width: 100px;
            /* Ensure logical minimum width */
            border: 2px solid #d3a625;
            box-shadow: 0 4px 15px rgba(211, 166, 37, 0.3);
        }

        .stat-label {
            color: #d3a625;
            font-size: 16px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .stat-value {
            color: #ff6b6b;
            font-size: 32px;
            font-weight: bold;
        }

        .text-display {
            background: rgba(255, 255, 255, 0.95);
            padding: 25px;
            border-radius: 12px;
            margin-bottom: 25px;
            font-size: 24px;
            line-height: 1.8;
            color: #2c1810;
            font-weight: 500;
            text-align: center;
            min-height: 140px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.3);
            border: 2px solid #740001;
            font-family: 'Georgia', serif;
        }

        .text-display span {
            position: relative;
        }

        .text-display .correct {
            color: #2d5016;
            font-weight: 700;
        }

        .text-display .current {
            background: #d3a625;
            color: #2c1810;
            padding: 2px 8px;
            border-radius: 4px;
            animation: glow 1.5s infinite;
            font-weight: 700;
        }

        @keyframes glow {

            0%,
            100% {
                box-shadow: 0 0 5px #d3a625;
            }

            50% {
                box-shadow: 0 0 15px #d3a625, 0 0 25px #d3a625;
            }
        }

        .text-display .incorrect {
            color: #ff0000;
            /* Bright red */
            background: rgba(255, 0, 0, 0.2);
            border-radius: 4px;
            padding: 0 2px;
            font-weight: 900;
            text-decoration: underline;
            /* Underscore error */
            box-shadow: 0 0 5px rgba(255, 0, 0, 0.5);
            /* Glowing error */
        }

        .input-area {
            background: rgba(255, 255, 255, 0.1);
            border: 3px solid #740001;
            border-radius: 12px;
            padding: 15px;
            font-size: 20px;
            /* Readable size */
            width: 100%;
            max-width: 100%;
            /* Ensure it fits */
            color: #ffffff;
            outline: none;
            transition: all 0.3s;
            font-family: 'Georgia', serif;
            box-sizing: border-box;
            /* Include padding in width */
        }

        .input-area:focus {
            border-color: #d3a625;
            box-shadow: 0 0 15px rgba(211, 166, 37, 0.5);
            background: rgba(255, 255, 255, 0.15);
        }

        .input-area::placeholder {
            color: rgba(255, 255, 255, 0.5);
            font-size: 18px;
        }

        .button {
            background: linear-gradient(135deg, #740001 0%, #d3a625 100%);
            color: #ffffff;
            border: none;
            padding: 18px 36px;
            border-radius: 12px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 25px;
            transition: all 0.3s;
            box-shadow: 0 6px 20px rgba(116, 0, 1, 0.5);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(116, 0, 1, 0.6);
        }

        .button:active {
            transform: translateY(0);
        }

        .button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .result-screen {
            display: none;
            text-align: center;
        }

        .result-screen.active {
            display: block;
        }

        .result-icon {
            font-size: 100px;
            margin-bottom: 20px;
            filter: drop-shadow(0 4px 8px rgba(255, 215, 0, 0.5));
        }

        .result-title {
            color: #ff6b6b;
            font-size: 42px;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.5);
        }

        .result-message {
            color: #d4a574;
            font-size: 20px;
            margin-bottom: 35px;
            font-style: italic;
        }

        .result-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 35px;
        }

        .hidden {
            display: none;
        }

        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            height: 10px;
            border-radius: 5px;
            margin-bottom: 25px;
            overflow: hidden;
            border: 1px solid #740001;
        }

        .progress-fill {
            background: linear-gradient(90deg, #740001, #d3a625);
            height: 100%;
            width: 0%;
            transition: width 0.3s;
            border-radius: 5px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: linear-gradient(135deg, #2c0a0a 0%, #1a0505 100%);
            padding: 40px;
            border-radius: 16px;
            border: 3px solid #740001;
            text-align: center;
            max-width: 500px;
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.8);
        }

        .modal-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .modal-title {
            color: #ff6b6b;
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(255, 107, 107, 0.5);
        }

        .modal-text {
            color: #d4a574;
            font-size: 18px;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .modal-button {
            background: linear-gradient(135deg, #740001 0%, #d3a625 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
        }

        .modal-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(116, 0, 1, 0.6);
        }
    </style>
</head>

<body>
    <script>
        for (let i = 0; i < 30; i++) {
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            sparkle.style.left = Math.random() * 100 + '%';
            sparkle.style.top = Math.random() * 100 + '%';
            sparkle.style.animationDelay = Math.random() * 2 + 's';
            document.body.appendChild(sparkle);
        }
    </script>

    <div class="container">
        <div id="gameScreen">
            <h1>ü¶Å Gryffindor Typing Test ü¶Å</h1>
            <p class="subtitle">"It takes a great deal of bravery to stand up to our enemies, but just as much to stand
                up to our friends."</p>

            <div class="progress-bar">
                <div class="progress-fill" id="progressBar"></div>
            </div>

            <div class="stats">
                <div class="stat-card">
                    <div class="stat-label">‚è±Ô∏è Time</div>
                    <div class="stat-value" id="timer">0s</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">‚ö° Speed</div>
                    <div class="stat-value" id="wpm">0 WPM</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">üéØ Accuracy</div>
                    <div class="stat-value" id="accuracy">100%</div>
                </div>
            </div>

            <div class="text-display" id="textDisplay"></div>

            <input type="text" class="input-area" id="inputArea" placeholder="Show your Gryffindor courage..."
                autocomplete="off" spellcheck="false">

            <button class="button" id="startButton">ü™Ñ Cast Your Spell</button>
        </div>

        <div id="resultScreen" class="result-screen">
            <div class="result-icon">‚ö°</div>
            <h2 class="result-title">Spell Casted Successfully!</h2>
            <p class="result-message">Your bravery and determination shine through!</p>

            <div class="result-stats">
                <div class="stat-card">
                    <div class="stat-label">‚è±Ô∏è Time Taken</div>
                    <div class="stat-value" id="finalTime">0s</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">‚ö° Typing Speed</div>
                    <div class="stat-value" id="finalWpm">0 WPM</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">üéØ Accuracy</div>
                    <div class="stat-value" id="finalAccuracy">100%</div>
                </div>
            </div>

            <button class="button" id="continueButton">‚ú® Continue to Dashboard</button>
        </div>
    </div>

    <div id="houseModal" class="modal">
        <div class="modal-content">
            <div class="modal-icon">ü¶Å</div>
            <h2 class="modal-title">You Belong to Gryffindor!</h2>
            <p class="modal-text">
                Your courage, bravery, and determination have proven you worthy of Gryffindor house.
                Like Harry Potter, Hermione Granger, and Ron Weasley, you embody the spirit of a true Gryffindor!
            </p>
            <button class="modal-button" id="modalButton">Continue</button>
        </div>
    </div>

    <script>
        const basicWords = [
            'cat', 'dog', 'run', 'jump', 'play', 'book', 'pen', 'cup', 'hat', 'sun',
            'moon', 'star', 'tree', 'bird', 'fish', 'home', 'door', 'wall', 'roof', 'car',
            'bike', 'walk', 'talk', 'read', 'write', 'sing', 'dance', 'eat', 'sleep', 'wake',
            'day', 'night', 'rain', 'snow', 'wind', 'fire', 'water', 'earth', 'sky', 'sea',
            'hill', 'rock', 'sand', 'grass', 'leaf', 'flower', 'fruit', 'food', 'milk', 'bread'
        ];

        let currentText = '';
        let startTime = null;
        let timerInterval = null;
        let correctChars = 0;
        let totalChars = 0;
        let isTestActive = false;

        const textDisplay = document.getElementById('textDisplay');
        const inputArea = document.getElementById('inputArea');
        const startButton = document.getElementById('startButton');
        const continueButton = document.getElementById('continueButton');
        const gameScreen = document.getElementById('gameScreen');
        const resultScreen = document.getElementById('resultScreen');
        const houseModal = document.getElementById('houseModal');
        const modalButton = document.getElementById('modalButton');
        const timerElement = document.getElementById('timer');
        const wpmElement = document.getElementById('wpm');
        const accuracyElement = document.getElementById('accuracy');
        const progressBar = document.getElementById('progressBar');

        function generateText() {
            const shuffled = [...basicWords].sort(() => Math.random() - 0.5);
            return shuffled.slice(0, 20).join(' ');
        }

        function updateDisplay() {
            const typed = inputArea.value;
            let html = '';

            for (let i = 0; i < currentText.length; i++) {
                const char = currentText[i];
                if (i < typed.length) {
                    if (typed[i] === char) {
                        html += `<span class="correct">${char}</span>`;
                    } else {
                        html += `<span class="incorrect">${char}</span>`;
                    }
                } else if (i === typed.length) {
                    html += `<span class="current">${char}</span>`;
                } else {
                    html += `<span>${char}</span>`;
                }
            }

            textDisplay.innerHTML = html;
            const progress = (typed.length / currentText.length) * 100;
            progressBar.style.width = progress + '%';
        }

        function updateStats() {
            if (!startTime) return;

            const elapsed = (Date.now() - startTime) / 1000;
            const minutes = elapsed / 60;

            timerElement.textContent = Math.floor(elapsed) + 's';

            const wordsTyped = inputArea.value.trim().split(/\s+/).length;
            const wpm = Math.round(wordsTyped / minutes) || 0;
            wpmElement.textContent = wpm + ' WPM';

            const typed = inputArea.value;
            correctChars = 0;
            totalChars = typed.length;

            for (let i = 0; i < typed.length; i++) {
                if (typed[i] === currentText[i]) {
                    correctChars++;
                }
            }

            const accuracy = totalChars > 0 ? Math.round((correctChars / totalChars) * 100) : 100;
            accuracyElement.textContent = accuracy + '%';
        }

        function startTest() {
            currentText = generateText();
            correctChars = 0;
            totalChars = 0;
            isTestActive = true;

            textDisplay.innerHTML = currentText;
            inputArea.value = '';
            inputArea.disabled = false;
            inputArea.focus();

            startButton.textContent = 'üîÆ Casting Spell...';
            startButton.disabled = true;

            startTime = Date.now();
            timerInterval = setInterval(updateStats, 100);
        }

        function endTest() {
            isTestActive = false;
            clearInterval(timerInterval);
            inputArea.disabled = true;

            const elapsed = (Date.now() - startTime) / 1000;
            const minutes = elapsed / 60;
            const wordsTyped = inputArea.value.trim().split(/\s+/).length;
            const wpm = Math.round(wordsTyped / minutes) || 0;
            const accuracy = totalChars > 0 ? Math.round((correctChars / totalChars) * 100) : 100;

            document.getElementById('finalTime').textContent = Math.floor(elapsed) + 's';
            document.getElementById('finalWpm').textContent = wpm + ' WPM';
            document.getElementById('finalAccuracy').textContent = accuracy + '%';

            gameScreen.classList.add('hidden');
            resultScreen.classList.add('active');

            setTimeout(() => {
                houseModal.classList.add('active');
            }, 1000);
        }

        inputArea.addEventListener('input', () => {
            if (!isTestActive) return;
            updateDisplay();
            updateStats();

            if (inputArea.value === currentText) {
                endTest();
            }
        });

        startButton.addEventListener('click', startTest);

        modalButton.addEventListener('click', () => {
            houseModal.classList.remove('active');
        });

        continueButton.addEventListener('click', () => {
            if (window.parent) {
                window.parent.postMessage({ type: 'TYPING_TEST_COMPLETE' }, '*');
            }

            setTimeout(() => {
                if (window.history.length > 1) {
                    window.history.back();
                } else {
                    window.close();
                }
            }, 100);
        });

        textDisplay.textContent = 'Click "Cast Your Spell" to begin your Gryffindor challenge!';
    </script>
</body>

</html>